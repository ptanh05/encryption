<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>B√†i 6: Frequency Analysis</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/fontello.css">
    <link rel="stylesheet" href="../css/design-system.css">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/lesson-styles.css">
    <link rel="stylesheet" href="../css/animations.css">
</head>
<body class="lesson" data-lesson="6">
    <nav class="lesson-nav">
        <a href="../index.html">‚Üê V·ªÅ trang ch·ªß</a>
        <div class="lesson-progress-bar">
            <div class="progress-fill"></div>
        </div>
    </nav>

    <header class="lesson-header">
        <h1>B√†i 6: Frequency Analysis</h1>
        <p class="lesson-meta">
            <span>‚è±Ô∏è Th·ªùi gian: ~30 ph√∫t</span>
            <span>‚≠ê ƒê·ªô kh√≥: Trung b√¨nh</span>
            <span>üìö Module 3: Ph√¢n t√≠ch v√† T·∫•n c√¥ng</span>
        </p>
    </header>

    <main class="lesson-content">
        <section class="theory">
            <h2>üìñ L√Ω thuy·∫øt</h2>
            
            <h3>Frequency Analysis l√† g√¨?</h3>
            <p>
                <strong>Frequency Analysis</strong> (Ph√¢n t√≠ch t·∫ßn su·∫•t) l√† k·ªπ thu·∫≠t ph√° m√£ b·∫±ng c√°ch 
                ph√¢n t√≠ch t·∫ßn su·∫•t xu·∫•t hi·ªán c·ªßa c√°c k√Ω t·ª± trong ciphertext v√† so s√°nh v·ªõi t·∫ßn su·∫•t 
                chu·∫©n c·ªßa ng√¥n ng·ªØ.
            </p>

            <h3>T·∫ßn su·∫•t ch·ªØ c√°i trong ti·∫øng Anh</h3>
            <p>Trong ti·∫øng Anh, c√°c ch·ªØ c√°i xu·∫•t hi·ªán v·ªõi t·∫ßn su·∫•t kh√°c nhau:</p>
            <div class="frequency-chart-container">
                <div id="english-frequency-chart" class="chart"></div>
            </div>

            <h3>C√°c k·ªπ thu·∫≠t Frequency Analysis</h3>
            <ul>
                <li><strong>Single-letter frequency:</strong> Ph√¢n t√≠ch t·∫ßn su·∫•t t·ª´ng ch·ªØ c√°i</li>
                <li><strong>Bigram frequency:</strong> Ph√¢n t√≠ch t·∫ßn su·∫•t c·∫∑p ch·ªØ c√°i (TH, HE, IN, ...)</li>
                <li><strong>Trigram frequency:</strong> Ph√¢n t√≠ch t·∫ßn su·∫•t b·ªô ba ch·ªØ c√°i (THE, AND, ...)</li>
                <li><strong>Word patterns:</strong> Ph√¢n t√≠ch ƒë·ªô d√†i t·ª´ v√† m·∫´u ch·ªØ c√°i</li>
            </ul>

            <h3>Chi-square Test</h3>
            <p>
                Chi-square test ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ƒëo ƒë·ªô t∆∞∆°ng ƒë·ªìng gi·ªØa t·∫ßn su·∫•t quan s√°t ƒë∆∞·ª£c v√† 
                t·∫ßn su·∫•t k·ª≥ v·ªçng. Gi√° tr·ªã chi-square c√†ng th·∫•p, vƒÉn b·∫£n c√†ng gi·ªëng ti·∫øng Anh.
            </p>
        </section>

        <section class="interactive-demo">
            <h2>üéÆ Th·ª≠ nghi·ªám</h2>
            
            <h3>Ph√¢n t√≠ch Ciphertext</h3>
            <div class="demo-container">
                <div class="demo-group">
                    <label>Nh·∫≠p ciphertext ƒë·ªÉ ph√¢n t√≠ch:</label>
                    <textarea id="analyze-input" rows="4" 
                              placeholder="Nh·∫≠p ciphertext..."></textarea>
                </div>
                <button class="demo-btn" onclick="analyzeFrequency()">Ph√¢n t√≠ch</button>
                
                <div id="analysis-results" style="margin-top: 1rem;">
                    <h4>T·∫ßn su·∫•t ch·ªØ c√°i:</h4>
                    <div id="frequency-chart" class="chart"></div>
                    
                    <h4>G·ª£i √Ω gi·∫£i m√£:</h4>
                    <div id="decryption-suggestions"></div>
                </div>
            </div>

            <h3>Auto-decrypt v·ªõi Frequency Analysis</h3>
            <div class="demo-container">
                <div class="demo-group">
                    <label>Ciphertext (Caesar Cipher):</label>
                    <input type="text" id="auto-decrypt-input" 
                           placeholder="Nh·∫≠p ciphertext...">
                </div>
                <button class="demo-btn" onclick="autoDecrypt()">T·ª± ƒë·ªông gi·∫£i m√£</button>
                <div id="auto-decrypt-result" style="margin-top: 1rem;"></div>
            </div>
        </section>

        <section class="quiz">
            <h2>üìù Ki·ªÉm tra ki·∫øn th·ª©c</h2>
            <div class="quiz-questions"></div>
            <button class="quiz-submit">N·ªôp b√†i</button>
            <div class="quiz-score"></div>
        </section>

        <section class="challenge">
            <h2>üéØ Th·ª≠ th√°ch</h2>
            <p>Ho√†n th√†nh c√°c th·ª≠ th√°ch sau:</p>
            <div class="challenges-list"></div>
        </section>
    </main>

    <footer class="lesson-footer">
        <button class="btn-prev" onclick="window.location.href='lesson-05-vigenere.html'">‚Üê B√†i tr∆∞·ªõc</button>
        <button class="btn-next" onclick="window.location.href='lesson-07-cryptanalysis.html'">B√†i ti·∫øp theo ‚Üí</button>
    </footer>

    <script src="../js/crypt-util.js"></script>
    <script src="../js/lesson-core.js"></script>
    <script>
        LessonCore.currentLesson = 6;
        LessonCore.updateLessonProgressBar();
        QuizSystem.init(6);
        ChallengeSystem.init(6);

        // English letter frequencies
        const englishFreq = {
            'E': 12.02, 'T': 9.10, 'A': 8.12, 'O': 7.68, 'I': 7.31,
            'N': 6.95, 'S': 6.28, 'R': 6.02, 'H': 5.92, 'D': 4.32,
            'L': 3.98, 'U': 2.88, 'C': 2.71, 'M': 2.61, 'F': 2.30,
            'Y': 2.11, 'W': 2.09, 'G': 2.03, 'P': 1.82, 'B': 1.49,
            'V': 1.11, 'K': 0.69, 'X': 0.17, 'Q': 0.11, 'J': 0.10, 'Z': 0.07
        };

        function analyzeFrequency() {
            const text = document.getElementById('analyze-input').value.toUpperCase();
            if (!text) return;

            const counts = {};
            let total = 0;

            for (let char of text) {
                if (char >= 'A' && char <= 'Z') {
                    counts[char] = (counts[char] || 0) + 1;
                    total++;
                }
            }

            const frequencies = {};
            for (let letter = 'A'; letter <= 'Z'; letter = String.fromCharCode(letter.charCodeAt(0) + 1)) {
                frequencies[letter] = counts[letter] ? (counts[letter] / total * 100) : 0;
            }

            // Display chart
            displayFrequencyChart('frequency-chart', frequencies);
            
            // Suggestions
            const suggestions = document.getElementById('decryption-suggestions');
            suggestions.innerHTML = '<p>So s√°nh v·ªõi t·∫ßn su·∫•t ti·∫øng Anh ƒë·ªÉ t√¨m mapping...</p>';
        }

        function displayFrequencyChart(containerId, frequencies) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            const maxFreq = Math.max(...Object.values(frequencies));
            
            for (let letter = 'A'; letter <= 'Z'; letter = String.fromCharCode(letter.charCodeAt(0) + 1)) {
                const bar = document.createElement('div');
                bar.style.display = 'inline-block';
                bar.style.width = '3%';
                bar.style.margin = '0 0.2%';
                bar.style.verticalAlign = 'bottom';
                bar.style.background = 'var(--accent)';
                bar.style.height = (frequencies[letter] / maxFreq * 200) + 'px';
                bar.title = `${letter}: ${frequencies[letter].toFixed(2)}%`;
                container.appendChild(bar);
            }
        }

        function autoDecrypt() {
            const ciphertext = document.getElementById('auto-decrypt-input').value.toUpperCase();
            if (!ciphertext) return;

            let bestShift = 0;
            let bestScore = Infinity;

            // Try all shifts and find best match
            for (let shift = 0; shift < 26; shift++) {
                let plaintext = '';
                for (let char of ciphertext) {
                    if (char >= 'A' && char <= 'Z') {
                        const shifted = ((char.charCodeAt(0) - 65 - shift + 26) % 26) + 65;
                        plaintext += String.fromCharCode(shifted);
                    } else {
                        plaintext += char;
                    }
                }

                // Calculate chi-square
                const score = calculateChiSquare(plaintext);
                if (score < bestScore) {
                    bestScore = score;
                    bestShift = shift;
                }
            }

            // Decrypt with best shift
            let result = '';
            for (let char of ciphertext) {
                if (char >= 'A' && char <= 'Z') {
                    const shifted = ((char.charCodeAt(0) - 65 - bestShift + 26) % 26) + 65;
                    result += String.fromCharCode(shifted);
                } else {
                    result += char;
                }
            }

            document.getElementById('auto-decrypt-result').innerHTML = 
                `<strong>Plaintext (shift=${bestShift}):</strong> ${result}`;
        }

        function calculateChiSquare(text) {
            const counts = {};
            let total = 0;

            for (let char of text) {
                if (char >= 'A' && char <= 'Z') {
                    counts[char] = (counts[char] || 0) + 1;
                    total++;
                }
            }

            let chiSquare = 0;
            for (let letter = 'A'; letter <= 'Z'; letter = String.fromCharCode(letter.charCodeAt(0) + 1)) {
                const observed = counts[letter] || 0;
                const expected = (englishFreq[letter] / 100) * total;
                chiSquare += Math.pow(observed - expected, 2) / expected;
            }

            return chiSquare;
        }

        // Display English frequency on load
        window.addEventListener('load', () => {
            displayFrequencyChart('english-frequency-chart', englishFreq);
        });

        const originalCheck = QuizSystem.checkAnswers.bind(QuizSystem);
        QuizSystem.checkAnswers = function() {
            const score = originalCheck();
            if (score >= 70) {
                LessonCore.markLessonComplete(6, score);
            }
        };
    </script>
    
    <style>
        .frequency-chart-container {
            margin: 1rem 0;
            padding: 1rem;
            background: var(--border-dark);
            border-radius: 0.3rem;
        }
    </style>
</body>
</html>

